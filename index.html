<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart Farm Dashboard</title>

  <style>
    :root{
      --blue1:#2b7fc0;
      --blue2:#1f5f94;
      --card: rgba(255,255,255,0.92);
      --shadow: 0 18px 40px rgba(0,0,0,0.35);
      --text:#0b1d2a;
      --muted:#5a6b77;
      --green:#22c55e;
      --red:#ef4444;
    }

    *{margin:0;padding:0;box-sizing:border-box;font-family:system-ui,Segoe UI,Arial;}

    body{
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:22px;
      background:
        linear-gradient(180deg, rgba(10,40,60,0.72), rgba(10,40,60,0.55)),
        url("https://images.unsplash.com/photo-1500382017468-9049fed747ef?auto=format&fit=crop&w=1800&q=60");
      background-size:cover;
      background-position:center;
    }

    .app{
      width:420px;
      max-width:95vw;
      border-radius:28px;
      overflow:hidden;
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(16px);
      border:1px solid rgba(255,255,255,0.18);
      box-shadow: var(--shadow);
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:14px 16px;
      color:white;
      background: rgba(0,0,0,0.22);
      font-weight:900;
      letter-spacing:0.6px;
    }

    .chip{
      padding:4px 9px;
      border-radius:999px;
      background: rgba(255,255,255,0.18);
      border:1px solid rgba(255,255,255,0.18);
      font-size:12px;
      font-weight:700;
    }

    .content{
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .weather-card{
      background: linear-gradient(135deg, var(--blue1), var(--blue2));
      color:white;
      border-radius:26px;
      padding:18px;
      position:relative;
      overflow:hidden;
      box-shadow: 0 16px 28px rgba(0,0,0,0.24);
    }

    .weather-card::after{
      content:"";
      position:absolute;
      top:-140px; right:-140px;
      width:320px; height:320px;
      background: rgba(255,255,255,0.12);
      transform: rotate(30deg);
      border-radius:60px;
    }

    .weather-top{
      position:relative;
      z-index:2;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
    }

    .place{
      font-size:28px;
      font-weight:900;
      margin-bottom:6px;
    }

    .temp{
      font-size:74px;
      font-weight:950;
      line-height:1;
      letter-spacing:-2px;
    }

    .rightWeather{
      text-align:right;
      margin-top:16px;
    }

    .mainIcon{
      font-size:24px;
      margin-bottom:8px;
      display:block;
    }

    .warning{
      font-size:16px;
      font-weight:700;
      opacity:0.95;
      max-width:210px;
      line-height:1.2;
    }

    .hourly{
      position:relative;
      z-index:2;
      margin-top:16px;
      display:flex;
      justify-content:space-between;
      gap:10px;
    }

    .hour{
      flex:1;
      text-align:center;
    }

    .hour .t{
      font-size:12px;
      opacity:0.9;
      margin-bottom:6px;
    }

    .hour .icon{
      font-size:18px;
      margin-bottom:6px;
    }

    .hour .deg{
      font-size:18px;
      font-weight:900;
    }

    .updated{
      position:relative;
      z-index:2;
      margin-top:10px;
      text-align:center;
      font-size:12px;
      opacity:0.85;
    }

    .info-row{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
    }

    .info-card{
      background: var(--card);
      border-radius:18px;
      padding:12px 10px;
      text-align:center;
      box-shadow: 0 10px 18px rgba(0,0,0,0.14);
      border:1px solid rgba(0,0,0,0.08);
      color:var(--text);
    }

    .info-card .label{
      font-size:13px;
      color:var(--muted);
      font-weight:800;
    }

    .info-card .value{
      margin-top:6px;
      font-size:18px;
      font-weight:950;
    }

    .notice{
      background: var(--card);
      border-radius:18px;
      padding:12px 14px;
      font-weight:900;
      text-align:center;
      box-shadow: 0 10px 18px rgba(0,0,0,0.14);
      border:1px solid rgba(0,0,0,0.08);
    }

    .btn-row{
      display:flex;
      gap:10px;
    }

    .small-btn{
      flex:1;
      padding:10px 12px;
      border:none;
      border-radius:14px;
      font-weight:900;
      cursor:pointer;
      box-shadow: 0 10px 18px rgba(0,0,0,0.16);
      background: rgba(255,255,255,0.92);
    }
  </style>
</head>

<body>

  <div class="app">
    <div class="topbar">
      <span class="chip">‚óÄ Back</span>
      SMART FARM
      <span class="chip">üì∂ üîã</span>
    </div>

    <div class="content">

      <div class="weather-card">
        <div class="weather-top">
          <div>
            <div class="place" id="city">Detecting...</div>
            <div class="temp"><span id="temp">--</span>¬∞</div>
          </div>

          <div class="rightWeather">
            <span class="mainIcon" id="mainIcon">‚è≥</span>
            <div class="warning" id="alert">Starting live weather...</div>
          </div>
        </div>

        <div class="hourly" id="hourly"></div>
        <div class="updated" id="updatedAt">Waiting...</div>
      </div>

      <div class="info-row">
        <div class="info-card">
          <div class="label">HUMIDITY</div>
          <div class="value" id="humidity">--%</div>
        </div>
        <div class="info-card">
          <div class="label">RAINING</div>
          <div class="value" id="raining">--</div>
        </div>
        <div class="info-card">
          <div class="label">MOISTURE</div>
          <div class="value" id="moisture">Moderate</div>
        </div>
      </div>

      <div class="notice" id="note">Waiting for weather update...</div>

      <div class="btn-row">
        <button class="small-btn" id="retryBtn">üîÑ Retry GPS</button>
        <button class="small-btn" id="cityBtn">üèô Enter City</button>
      </div>

    </div>
  </div>

  <script>
    const cityEl = document.getElementById("city");
    const tempEl = document.getElementById("temp");
    const humidityEl = document.getElementById("humidity");
    const rainingEl = document.getElementById("raining");
    const noteEl = document.getElementById("note");
    const hourlyEl = document.getElementById("hourly");
    const alertEl = document.getElementById("alert");
    const mainIconEl = document.getElementById("mainIcon");
    const updatedAtEl = document.getElementById("updatedAt");

    function formatHour(timeStr){
      const d = new Date(timeStr);
      let h = d.getHours();
      const ampm = h >= 12 ? "PM" : "AM";
      h = h % 12;
      if(h === 0) h = 12;
      return `${h}${ampm}`;
    }

    function weatherEmoji(code){
      if(code === 0) return "‚òÄÔ∏è";
      if([1,2].includes(code)) return "‚õÖ";
      if(code === 3) return "‚òÅÔ∏è";
      if([45,48].includes(code)) return "üå´Ô∏è";
      if([51,53,55,56,57].includes(code)) return "üå¶Ô∏è";
      if([61,63,65,80,81,82].includes(code)) return "üåßÔ∏è";
      if([71,73,75,77,85,86].includes(code)) return "‚ùÑÔ∏è";
      if([95,96,99].includes(code)) return "‚õàÔ∏è";
      return "üå§Ô∏è";
    }

    async function reverseGeo(lat, lon){
      const url = `https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}&count=1`;
      const res = await fetch(url);
      const data = await res.json();
      return data?.results?.[0]?.name || "Your Location";
    }

    async function geoFromCity(cityName){
      const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(cityName)}&count=1`;
      const res = await fetch(url);
      const data = await res.json();
      if(data?.results?.length){
        return {
          name: data.results[0].name,
          lat: data.results[0].latitude,
          lon: data.results[0].longitude
        };
      }
      throw new Error("City not found");
    }

    async function loadWeather(lat, lon){
      const url =
        `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}` +
        `&current=temperature_2m,relative_humidity_2m,precipitation,weather_code` +
        `&hourly=temperature_2m,weather_code` +
        `&timezone=auto`;

      alertEl.textContent = "Fetching weather...";
      mainIconEl.textContent = "‚è≥";

      const res = await fetch(url);
      const data = await res.json();

      const currentTemp = Math.round(data.current.temperature_2m);
      const currentHumidity = data.current.relative_humidity_2m;
      const currentRain = data.current.precipitation;
      const currentCode = data.current.weather_code;

      tempEl.textContent = currentTemp;
      humidityEl.textContent = currentHumidity + "%";
      rainingEl.textContent = currentRain > 0 ? "YES" : "NO";
      mainIconEl.textContent = weatherEmoji(currentCode);

      alertEl.textContent = currentRain > 0 ? "Raining now üåßÔ∏è" : "Weather stable ‚úÖ";
      noteEl.textContent = "Live weather loaded ‚úÖ";

      hourlyEl.innerHTML = "";

      const times = data.hourly.time;
      const temps = data.hourly.temperature_2m;
      const codes = data.hourly.weather_code;

      const now = new Date();
      let startIndex = times.findIndex(t => new Date(t) >= now);
      if(startIndex < 0) startIndex = 0;

      for(let i=startIndex;i<startIndex+6;i++){
        const box = document.createElement("div");
        box.className = "hour";
        box.innerHTML = `
          <div class="t">${formatHour(times[i])}</div>
          <div class="icon">${weatherEmoji(codes[i])}</div>
          <div class="deg">${Math.round(temps[i])}¬∞</div>
        `;
        hourlyEl.appendChild(box);
      }

      updatedAtEl.textContent = "Updated: " + new Date().toLocaleTimeString();
    }

    async function startGPS(){
      cityEl.textContent = "Detecting...";
      alertEl.textContent = "Requesting GPS permission...";
      updatedAtEl.textContent = "Waiting for GPS...";
      mainIconEl.textContent = "üìç";

      navigator.geolocation.getCurrentPosition(
        async (pos) => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;

          cityEl.textContent = await reverseGeo(lat, lon);
          await loadWeather(lat, lon);

          setInterval(() => loadWeather(lat, lon), 5 * 60 * 1000);
        },
        (err) => {
          console.log("GPS Error:", err);

          cityEl.textContent = "GPS BLOCKED ‚ùå";
          alertEl.textContent = "Click üèô Enter City (fallback)";
          noteEl.textContent = "Your browser did not give location.";
          updatedAtEl.textContent = "No GPS data";
          mainIconEl.textContent = "‚ùå";
        },
        { enableHighAccuracy:true, timeout:20000, maximumAge:0 }
      );
    }

    document.getElementById("retryBtn").onclick = () => startGPS();

    document.getElementById("cityBtn").onclick = async () => {
      const userCity = prompt("Enter your city (example: Chennai):");
      if(!userCity) return;

      try{
        const loc = await geoFromCity(userCity);
        cityEl.textContent = loc.name;
        await loadWeather(loc.lat, loc.lon);
        setInterval(() => loadWeather(loc.lat, loc.lon), 5 * 60 * 1000);
      }catch(e){
        alert("City not found ‚ùå Try again.");
      }
    };

    startGPS();
  </script>

</body>
</html>

